import pytest

from main import part1, part2, LEFT, UP, RIGHT, DOWN, parse_level, map_instruction, move, find_first_empty_space, move_sequence, get_box_positions, \
    sum_gps_coordinates, expand_level, move2, find_distance_first_horizontal_empty_space, find_chained_boxes, move2_sequence, get_big_box_positions


@pytest.mark.parametrize("filename, expected",
                         [("example.txt", 10092),
                          ("example2.txt", 2028)
                          ])
def test_part1(filename, expected):
    # Given
    with open(filename) as f:
        lines = f.read().splitlines()
    # When
    result = part1(lines)
    # Then
    assert result == expected


@pytest.mark.parametrize("filename, expected",
                         [("example.txt", 9021)
                          ])
def test_part2(filename, expected):
    # Given
    with open(filename) as f:
        lines = f.read().splitlines()
    # When
    result = part2(lines)
    # Then
    assert result == expected


@pytest.mark.parametrize("instruction, expected",
                         [('^', UP),
                          ('v', DOWN),
                          ('<', LEFT),
                          ('>', RIGHT)
                          ])
def test_map_instruction(instruction, expected):
    # Given
    # When
    result = map_instruction(instruction)
    # Then
    assert result == expected


def test_parse_level():
    # Given
    lines = [
        "########",
        "#..O.O.#",
        "##@.O..#",
        "#...O..#",
        "#.#.O..#",
        "#...O..#",
        "#......#",
        "########",
        "",
        "<^^>>>vv<v",
        ">>v<<"
    ]
    # When
    level, movements, starting_position = parse_level(lines)
    # Then
    assert level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', 'O', '.', 'O', '.', '#'],
        ['#', '#', '@', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert movements == [LEFT, UP, UP, RIGHT, RIGHT, RIGHT, DOWN, DOWN, LEFT, DOWN,
                         RIGHT, RIGHT, DOWN, LEFT, LEFT]
    assert starting_position == (2, 2)


def test_move_no_obstacle():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', 'O', '.', 'O', '.', '#'],
        ['#', '#', '@', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    position = (2, 2)
    movement = UP
    # When
    next_level, next_position = move(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '@', 'O', '.', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert next_position == (2, 1)


def test_move_direct_obstacle():
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', 'O', '.', 'O', '.', '#'],
        ['#', '#', '@', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    position = (2, 2)
    movement = LEFT
    # When
    next_level, next_position = move(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', 'O', '.', 'O', '.', '#'],
        ['#', '#', '@', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert next_position == (2, 2)


def test_move_single_box():
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '@', 'O', '.', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    position = (2, 1)
    movement = RIGHT
    # When
    next_level, next_position = move(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '@', 'O', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert next_position == (3, 1)


def test_find_first_empty_space_single_box():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '@', 'O', '.', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    first_box_position = (3, 1)
    movement = RIGHT
    # When
    result = find_first_empty_space(level, first_box_position, movement)
    # Then
    assert result == (4, 1)


def test_find_first_empty_space_box_against_wall():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '@', 'O', '.', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    first_box_position = (3, 1)
    movement = UP
    # When
    result = find_first_empty_space(level, first_box_position, movement)
    # Then
    assert result == False


def test_find_first_empty_space_multiple_boxes():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '@', 'O', '.', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    first_box_position = (4, 2)
    movement = DOWN
    # When
    result = find_first_empty_space(level, first_box_position, movement)
    # Then
    assert result == (4, 6)


def test_move_multiple_boxes():
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '@', 'O', 'O', '.', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    position = (3, 1)
    movement = RIGHT
    # When
    next_level, next_position = move(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '.', '@', 'O', 'O', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert next_position == (4, 1)


def test_move_multiple_boxes_against_wall():
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '.', '@', 'O', 'O', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    position = (4, 1)
    movement = RIGHT
    # When
    next_level, next_position = move(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '.', '@', 'O', 'O', '#'],
        ['#', '#', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert next_position == (4, 1)


def test_move_sequence():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', 'O', '.', 'O', '.', '#'],
        ['#', '#', '@', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '#', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    movements = [LEFT, UP, UP, RIGHT, RIGHT, RIGHT, DOWN, DOWN, LEFT, DOWN,
                 RIGHT, RIGHT, DOWN, LEFT, LEFT]
    starting_position = (2, 2)
    # When
    level, end_position = move_sequence(level, starting_position, movements)
    # Then
    assert level == [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '.', '.', 'O', 'O', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', 'O', '#'],
        ['#', '.', '#', 'O', '@', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    assert end_position == (4, 4)


def test_get_box_positions():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', '.', '.', 'O', 'O', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '#'],
        ['#', '.', '.', '.', '.', '.', 'O', '#'],
        ['#', '.', '#', 'O', '@', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '.', '.', '.', 'O', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#'],
    ]
    # When
    result = get_box_positions(level)
    # Then
    assert result == {(5, 1), (6, 1), (6, 3), (3, 4), (4, 5), (4, 6)}


def test_sum_gps_coordinates():
    # Given
    box_positions = {(5, 1), (6, 1), (6, 3), (3, 4), (4, 5), (4, 6)}
    # When
    result = sum_gps_coordinates(box_positions)
    # Then
    assert result == 2028


def test_expand_level():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '.', '.', 'O', '.', '.', 'O', '.', 'O', '#'],
        ['#', '.', '.', '.', '.', '.', '.', 'O', '.', '#'],
        ['#', '.', 'O', 'O', '.', '.', 'O', '.', 'O', '#'],
        ['#', '.', '.', 'O', '@', '.', '.', 'O', '.', '#'],
        ['#', 'O', '#', '.', '.', 'O', '.', '.', '.', '#'],
        ['#', 'O', '.', '.', 'O', '.', '.', 'O', '.', '#'],
        ['#', '.', 'O', 'O', '.', 'O', '.', 'O', 'O', '#'],
        ['#', '.', '.', '.', '.', 'O', '.', '.', '.', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    # When
    level, starting_position = expand_level(level)
    # Then
    assert level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '@', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert starting_position == (8, 4)


def test_move2_no_obstacle():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '@', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    position = (8, 4)
    movement = UP
    # When
    next_level, next_position = move2(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert next_position == (8, 3)


def test_move2_direct_obstacle():
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    position = (8, 1)
    movement = UP
    # When
    next_level, next_position = move2(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert next_position == (8, 1)


def test_find_distance_first_horizontal_empty_space():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    next_position = (7, 1)
    movement = LEFT
    # When
    result = find_distance_first_horizontal_empty_space(level, next_position, movement)
    # Then
    assert result == 3


def test_find_distance_first_horizontal_empty_space_multiple_boxes():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    next_position = (7, 3)
    movement = LEFT
    # When
    result = find_distance_first_horizontal_empty_space(level, next_position, movement)
    # Then
    assert result == 5


def test_move2_multiple_boxes_no_obstacle():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    position = (8, 3)
    movement = LEFT
    # When
    next_level, next_position = move2(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '[', ']', '[', ']', '@', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert next_position == (7, 3)


def test_move2_multiple_boxes_against_wall():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '[', ']', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    position = (8, 3)
    movement = LEFT
    # When
    next_level, next_position = move2(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '[', ']', '[', ']', '@', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert next_position == (8, 3)


def test_move2_single_box_vertically():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '@', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    position = (8, 5)
    movement = DOWN
    # When
    next_level, next_position = move2(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '@', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '[', ']', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert next_position == (8, 6)


def test_find_chained_boxes_aligned():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '@', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    first_box_position = (6, 4)
    movement = UP
    # When
    result = find_chained_boxes(level, first_box_position, movement)
    # Then
    assert result == {(6, 4), (6, 3)}


def test_find_chained_boxes_shifted():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '@', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    first_box_position = (5, 4)
    movement = UP
    # When
    result = find_chained_boxes(level, first_box_position, movement)
    # Then
    assert result == {(5, 4), (4, 3), (6, 3)}


def test_find_chained_boxes_leading_to_obstacle():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '[', ']', '[', ']', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '@', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    first_box_position = (5, 4)
    movement = UP
    # When
    result = find_chained_boxes(level, first_box_position, movement)
    # Then
    assert result == set()


def test_move2_multiple_chained_boxes():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '@', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    position = (6, 5)
    movement = UP
    # When
    next_level, next_position = move2(level, position, movement)
    # Then
    assert next_level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '[', ']', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '@', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert next_position == (6, 4)


def test_move2_sequence():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '[', ']', '@', '.', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '#', '#', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    starting_position = (8, 4)
    movements = [LEFT, DOWN, DOWN, RIGHT, UP, LEFT, DOWN, UP, RIGHT, DOWN, RIGHT, UP, DOWN, DOWN, UP, DOWN, RIGHT, DOWN, LEFT, RIGHT, DOWN, UP, DOWN, LEFT,
                 DOWN, LEFT, UP, DOWN, DOWN, LEFT, LEFT, LEFT, UP, RIGHT, LEFT, LEFT, RIGHT, LEFT, RIGHT, RIGHT, DOWN, LEFT, DOWN, DOWN, DOWN, LEFT, RIGHT, UP,
                 DOWN, UP, RIGHT, UP, LEFT, LEFT, LEFT, RIGHT, LEFT, LEFT, DOWN, LEFT, LEFT, LEFT, DOWN, UP, DOWN, DOWN, UP, DOWN, RIGHT, UP, DOWN, DOWN, LEFT,
                 LEFT, UP, RIGHT, UP, DOWN, UP, UP, RIGHT, LEFT, LEFT, RIGHT, RIGHT, RIGHT, LEFT, RIGHT, UP, LEFT, LEFT, RIGHT, LEFT, UP, DOWN, DOWN, UP, UP,
                 LEFT, RIGHT, DOWN, DOWN, DOWN, LEFT, RIGHT, RIGHT, LEFT, UP, UP, DOWN, RIGHT, UP, RIGHT, DOWN, DOWN, LEFT, RIGHT, DOWN, LEFT, LEFT, LEFT, LEFT,
                 DOWN, LEFT, UP, DOWN, RIGHT, UP, LEFT, UP, UP, RIGHT, RIGHT, RIGHT, UP, LEFT, DOWN, LEFT, DOWN, RIGHT, LEFT, RIGHT, DOWN, DOWN, RIGHT, DOWN,
                 UP, DOWN, UP, LEFT, RIGHT, RIGHT, LEFT, RIGHT, RIGHT, RIGHT, RIGHT, LEFT, UP, UP, RIGHT, DOWN, DOWN, RIGHT, DOWN, LEFT, UP, UP, UP, RIGHT,
                 RIGHT, DOWN, UP, DOWN, UP, LEFT, UP, UP, RIGHT, DOWN, UP, UP, RIGHT, DOWN, UP, LEFT, UP, DOWN, RIGHT, DOWN, LEFT, RIGHT, RIGHT, DOWN, UP, DOWN,
                 UP, LEFT, DOWN, RIGHT, DOWN, UP, UP, LEFT, UP, UP, DOWN, DOWN, LEFT, LEFT, LEFT, DOWN, LEFT, UP, RIGHT, RIGHT, UP, UP, UP, UP, RIGHT, RIGHT,
                 RIGHT, DOWN, UP, LEFT, RIGHT, DOWN, DOWN, DOWN, UP, RIGHT, LEFT, DOWN, LEFT, LEFT, LEFT, RIGHT, UP, UP, UP, DOWN, DOWN, UP, LEFT, DOWN, DOWN,
                 DOWN, RIGHT, UP, RIGHT, DOWN, LEFT, UP, UP, UP, UP, DOWN, LEFT, RIGHT, UP, RIGHT, DOWN, DOWN, DOWN, DOWN, RIGHT, LEFT, RIGHT, RIGHT, DOWN, UP,
                 LEFT, LEFT, UP, UP, UP, UP, UP, UP, RIGHT, LEFT, UP, RIGHT, LEFT, RIGHT, RIGHT, RIGHT, LEFT, RIGHT, UP, UP, LEFT, LEFT, UP, UP, DOWN, RIGHT,
                 RIGHT, RIGHT, LEFT, UP, LEFT, DOWN, RIGHT, UP, LEFT, DOWN, DOWN, RIGHT, RIGHT, DOWN, RIGHT, RIGHT, RIGHT, UP, DOWN, RIGHT, LEFT, RIGHT, UP,
                 DOWN, RIGHT, LEFT, LEFT, LEFT, LEFT, DOWN, RIGHT, RIGHT, DOWN, LEFT, DOWN, LEFT, DOWN, RIGHT, DOWN, DOWN, DOWN, RIGHT, UP, LEFT, RIGHT, LEFT,
                 LEFT, RIGHT, UP, RIGHT, LEFT, UP, RIGHT, RIGHT, LEFT, RIGHT, UP, DOWN, LEFT, RIGHT, LEFT, UP, DOWN, DOWN, DOWN, LEFT, UP, UP, LEFT, RIGHT,
                 LEFT, DOWN, LEFT, LEFT, LEFT, LEFT, LEFT, RIGHT, LEFT, UP, DOWN, LEFT, LEFT, LEFT, RIGHT, LEFT, LEFT, LEFT, UP, UP, LEFT, DOWN, LEFT, UP, UP,
                 UP, RIGHT, LEFT, UP, RIGHT, RIGHT, UP, LEFT, DOWN, UP, RIGHT, LEFT, LEFT, LEFT, UP, RIGHT, RIGHT, UP, DOWN, LEFT, DOWN, UP, DOWN, LEFT, DOWN,
                 UP, RIGHT, UP, RIGHT, RIGHT, UP, DOWN, RIGHT, DOWN, DOWN, RIGHT, UP, LEFT, LEFT, UP, DOWN, LEFT, RIGHT, RIGHT, LEFT, LEFT, RIGHT, LEFT, LEFT,
                 DOWN, LEFT, LEFT, DOWN, RIGHT, LEFT, RIGHT, DOWN, LEFT, UP, DOWN, DOWN, LEFT, LEFT, LEFT, RIGHT, UP, UP, DOWN, UP, RIGHT, UP, UP, RIGHT, RIGHT,
                 RIGHT, LEFT, LEFT, UP, DOWN, RIGHT, RIGHT, DOWN, UP, DOWN, RIGHT, LEFT, UP, UP, RIGHT, RIGHT, UP, LEFT, RIGHT, DOWN, DOWN, UP, LEFT, RIGHT,
                 LEFT, UP, UP, RIGHT, UP, UP, UP, LEFT, RIGHT, LEFT, DOWN, DOWN, DOWN, DOWN, DOWN, UP, DOWN, LEFT, DOWN, LEFT, LEFT, RIGHT, UP, DOWN, LEFT,
                 DOWN, RIGHT, DOWN, LEFT, LEFT, UP, RIGHT, LEFT, LEFT, RIGHT, LEFT, LEFT, RIGHT, LEFT, LEFT, LEFT, UP, UP, LEFT, LEFT, LEFT, UP, LEFT, LEFT,
                 RIGHT, RIGHT, LEFT, LEFT, RIGHT, LEFT, UP, UP, UP, RIGHT, UP, UP, LEFT, RIGHT, UP, RIGHT, DOWN, LEFT, RIGHT, UP, UP, RIGHT, DOWN, DOWN, LEFT,
                 UP, DOWN, UP, DOWN, LEFT, DOWN, DOWN, RIGHT, UP, LEFT, RIGHT, LEFT, DOWN, LEFT, UP, DOWN, RIGHT, UP, UP, UP, RIGHT, RIGHT, RIGHT, UP, UP, DOWN,
                 DOWN, DOWN, UP, RIGHT, DOWN, DOWN, DOWN, LEFT, RIGHT, RIGHT, RIGHT, UP, LEFT, UP, RIGHT, RIGHT, RIGHT, RIGHT, RIGHT, UP, LEFT, LEFT, UP, DOWN,
                 RIGHT, UP, DOWN, DOWN, DOWN, LEFT, RIGHT, UP, LEFT, RIGHT, LEFT, LEFT, DOWN, RIGHT, UP, UP, RIGHT, RIGHT, RIGHT, LEFT, LEFT, UP, UP, LEFT,
                 RIGHT, RIGHT, UP, DOWN, UP, LEFT, DOWN, UP, DOWN, DOWN, LEFT, RIGHT, DOWN, UP, LEFT, LEFT, RIGHT, UP, LEFT, UP, DOWN, UP, DOWN, RIGHT, LEFT,
                 UP, LEFT, LEFT, LEFT, RIGHT, LEFT, LEFT, UP, LEFT, DOWN, RIGHT, LEFT, DOWN, LEFT, RIGHT, DOWN, DOWN, RIGHT, RIGHT, DOWN, RIGHT, LEFT, DOWN, UP,
                 LEFT, DOWN, DOWN, LEFT, RIGHT, DOWN, UP, LEFT, LEFT, UP]

    # When
    level, end_position = move2_sequence(level, starting_position, movements)
    # Then
    assert level == [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '#', '#', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '@', '.', '.', '.', '.', '.', '.', '[', ']', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    assert end_position == (4, 7)


def test_get_big_box_positions():
    # Given
    level = [
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '.', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '[', ']', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '[', ']', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '#', '#', '.', '.', '.', '.', '.', '.', '[', ']', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '[', ']', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '#'],
        ['#', '#', '.', '.', '@', '.', '.', '.', '.', '.', '.', '[', ']', '.', '[', ']', '[', ']', '#', '#'],
        ['#', '#', '.', '.', '.', '.', '.', '.', '[', ']', '[', ']', '.', '.', '[', ']', '.', '.', '#', '#'],
        ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
    ]
    # When
    result = get_big_box_positions(level)
    # Then
    assert result == {(2, 1), (2, 2), (2, 3), (2, 4), (4, 6), (8, 8), (10, 4), (10, 8), (11, 1), (11, 7), (12, 3), (12, 5), (14, 1), (14, 3), (14, 7), (14, 8),
                      (15, 2), (16, 1), (16, 3), (16, 4), (16, 7)}
